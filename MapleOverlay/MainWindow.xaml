<Window x:Class="MapleOverlay.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        Title="ML_Overlay" 
        Height="450" Width="800"
        Background="Transparent" 
        AllowsTransparency="True" 
        WindowStyle="None"
        Topmost="True" 
        ShowInTaskbar="True">
    
    <Grid>
        <!-- 1. 아이템 정보 패널 -->
        <Border x:Name="InfoPanel" 
                Width="300"
                MaxHeight="600"
                Background="#CC000000" 
                CornerRadius="10" 
                HorizontalAlignment="Center" 
                VerticalAlignment="Center"
                Visibility="Hidden"
                MouseLeftButtonDown="Panel_MouseLeftButtonDown">
            
            <Grid>
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="*"/>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                </Grid.RowDefinitions>

                <!-- 닫기 버튼 -->
                <Grid Grid.Row="0" Margin="0,5,5,0">
                    <Button x:Name="CloseButton" 
                            Content="✕" 
                            HorizontalAlignment="Right"
                            Width="25" Height="25"
                            Background="Transparent"
                            Foreground="#AAAAAA"
                            BorderThickness="0"
                            FontWeight="Bold"
                            Click="CloseButton_Click"
                            Cursor="Hand"/>
                </Grid>

                <!-- 내용 -->
                <ScrollViewer Grid.Row="1" VerticalScrollBarVisibility="Auto" Margin="5,0,5,0" MaxHeight="500">
                    <StackPanel Margin="10,0,10,10">
                        <TextBlock x:Name="ItemNameText" Text="아이템명" Foreground="#FFCC00" FontSize="18" FontWeight="Bold" TextWrapping="Wrap"/>
                        <Button x:Name="LinkButton" Content="MapleLand.gg 확인 ↗" Click="LinkButton_Click" Visibility="Collapsed" HorizontalAlignment="Left" Margin="0,5,0,0" Background="#333333" Foreground="#AAAAAA" BorderThickness="0" Padding="5,2" Cursor="Hand" FontSize="11"/>
                        <Separator Margin="0,10" Background="#555555"/>
                        <TextBlock x:Name="ItemReqText" Text="" Foreground="#FF9900" FontSize="12" TextWrapping="Wrap" Visibility="Collapsed"/>
                        <Separator x:Name="ReqSeparator" Margin="0,8" Background="#444444" Visibility="Collapsed"/>
                        <TextBlock x:Name="ItemStatsText" Text="" Foreground="White" FontSize="13" LineHeight="20" TextWrapping="Wrap"/>
                        <Separator x:Name="DescSeparator" Margin="0,10" Background="#555555" Visibility="Collapsed"/>
                        <TextBlock x:Name="ItemPriceText" Text="" Foreground="#00FF00" FontSize="12" TextWrapping="Wrap" Visibility="Collapsed" Margin="0,0,0,10"/>
                        <TextBlock x:Name="ItemDescText" Text="설명" Foreground="#AAAAAA" FontSize="11" TextWrapping="Wrap" FontFamily="Consolas"/>
                    </StackPanel>
                </ScrollViewer>

                <!-- 수동 검색 -->
                <Border Grid.Row="2" Margin="10,5,10,5" Background="#33FFFFFF" CornerRadius="5" Padding="5">
                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="Auto"/>
                        </Grid.ColumnDefinitions>
                        <TextBox x:Name="SearchInput" Grid.Column="0" Height="25" VerticalContentAlignment="Center" Background="Transparent" Foreground="White" BorderThickness="0" CaretBrush="White" KeyDown="SearchInput_KeyDown" Text="직접 검색..."/>
                        <Button x:Name="SearchButton" Grid.Column="1" Content="검색" Width="50" Height="25" Margin="5,0,0,0" Click="SearchButton_Click" Background="#444444" Foreground="White" BorderThickness="0"/>
                    </Grid>
                </Border>

                <!-- 단축키 안내 -->
                <TextBlock x:Name="KeyGuideText" 
                           Grid.Row="3"
                           Text="메뉴: F12 | 캡처: ` | 닫기: ESC" 
                           Foreground="#888888" 
                           FontSize="11" 
                           HorizontalAlignment="Center"
                           Margin="0,0,0,10"/>
            </Grid>
        </Border>

        <!-- 2. 경험치 타이머 패널 -->
        <Border x:Name="ExpPanel" 
                Width="320"
                Background="#EE001100" 
                CornerRadius="10" 
                BorderBrush="#00FF00"
                BorderThickness="1"
                HorizontalAlignment="Center" 
                VerticalAlignment="Center"
                Visibility="Hidden"
                MouseLeftButtonDown="Panel_MouseLeftButtonDown">
            <Grid Margin="15">
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/> <!-- 제목 & 닫기 -->
                    <RowDefinition Height="Auto"/> <!-- 상태 표시 -->
                    <RowDefinition Height="Auto"/> <!-- 타이머 설정 -->
                    <RowDefinition Height="Auto"/> <!-- 통계 -->
                    <RowDefinition Height="Auto"/> <!-- 버튼 -->
                </Grid.RowDefinitions>

                <!-- 제목 & 컨트롤 -->
                <Grid Grid.Row="0" Margin="0,0,0,10">
                    <TextBlock Text="⏱ 경험치 타이머" Foreground="#00FF00" FontSize="16" FontWeight="Bold" VerticalAlignment="Center"/>
                    <StackPanel Orientation="Horizontal" HorizontalAlignment="Right">
                        <Button Content="─" Width="25" Height="25" Background="Transparent" Foreground="#AAAAAA" BorderThickness="0" FontWeight="Bold" Click="BtnMinimizeExp_Click" Cursor="Hand" Margin="0,0,5,0"/>
                        <Button Content="✕" Width="25" Height="25" Background="Transparent" Foreground="#AAAAAA" BorderThickness="0" FontWeight="Bold" Click="CloseExpButton_Click" Cursor="Hand"/>
                    </StackPanel>
                </Grid>

                <!-- 상태 표시 -->
                <StackPanel Grid.Row="1" Margin="0,0,0,10">
                    <TextBlock Text="[OCR 인식 결과]" Foreground="#666666" FontSize="10"/>
                    <TextBlock x:Name="TxtDebugOcr" Text="-" Foreground="#FF00FF" FontSize="11" Margin="0,0,0,10" TextWrapping="Wrap"/>
                    <Grid Margin="0,0,0,5">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="*"/>
                        </Grid.ColumnDefinitions>
                        <StackPanel Grid.Column="0">
                            <TextBlock Text="시작 경험치" Foreground="#888888" FontSize="11"/>
                            <TextBlock x:Name="TxtStartExp" Text="-" Foreground="White" FontSize="12"/>
                        </StackPanel>
                        <StackPanel Grid.Column="1">
                            <TextBlock Text="현재 경험치" Foreground="#888888" FontSize="11"/>
                            <TextBlock x:Name="TxtCurrentExp" Text="-" Foreground="White" FontSize="12"/>
                        </StackPanel>
                    </Grid>
                    <TextBlock Text="시작 시간" Foreground="#888888" FontSize="12" Margin="0,5,0,0"/>
                    <TextBlock x:Name="TxtStartTime" Text="-" Foreground="#AAAAAA" FontSize="14"/>
                    <TextBlock Text="경과 시간" Foreground="#888888" FontSize="12" Margin="0,5,0,0"/>
                    <TextBlock x:Name="TxtElapsedTime" Text="00:00:00" Foreground="#FFFF00" FontSize="14"/>
                </StackPanel>

                <!-- 타이머 설정 -->
                <Border Grid.Row="2" Background="#3300FF00" CornerRadius="5" Padding="10" Margin="0,0,0,15">
                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="Auto"/>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="Auto"/>
                        </Grid.ColumnDefinitions>
                        <StackPanel Grid.Column="0" Orientation="Horizontal" VerticalAlignment="Center">
                            <TextBox x:Name="InputTimerMinutes" Text="6" Width="30" Height="25" VerticalContentAlignment="Center" HorizontalContentAlignment="Center" Background="#44000000" Foreground="White" BorderBrush="#666666" BorderThickness="1"/>
                            <TextBlock Text="분" Foreground="White" VerticalAlignment="Center" Margin="5,0,0,0"/>
                        </StackPanel>
                        <TextBlock x:Name="TxtTimerCountdown" Grid.Column="1" Text="00:00" Foreground="#00FF00" FontSize="20" FontWeight="Bold" HorizontalAlignment="Center" VerticalAlignment="Center"/>
                        <Button x:Name="BtnToggleTimer" Grid.Column="2" Content="타이머 시작" Width="80" Height="25" Background="#006600" Foreground="White" BorderThickness="0" Click="BtnToggleTimer_Click" Cursor="Hand" FontWeight="Bold"/>
                    </Grid>
                </Border>

                <!-- 통계 -->
                <Border Grid.Row="3" Background="#33000000" CornerRadius="5" Padding="10" Margin="0,0,0,15">
                    <StackPanel>
                        <Grid Margin="0,0,0,5">
                            <TextBlock Text="획득 경험치" Foreground="#AAAAAA"/>
                            <TextBlock x:Name="TxtGainedExp" Text="0" Foreground="#00FF00" HorizontalAlignment="Right" FontWeight="Bold"/>
                        </Grid>
                        <Grid>
                            <TextBlock Text="시간당 획득" Foreground="#AAAAAA"/>
                            <TextBlock x:Name="TxtExpPerHour" Text="0 / hr" Foreground="#00CCFF" HorizontalAlignment="Right" FontWeight="Bold"/>
                        </Grid>
                    </StackPanel>
                </Border>

                <!-- 버튼 -->
                <Grid Grid.Row="4">
                    <Button Content="즉시 갱신" 
                            Height="35" 
                            Background="#333333" 
                            Foreground="#AAAAAA" 
                            BorderThickness="0"
                            Click="BtnUpdateExp_Click"
                            Cursor="Hand"/>
                </Grid>
            </Grid>
        </Border>

        <!-- 3. 실시간 경험치 패널 -->
        <Border x:Name="RealTimeExpPanel" 
                Width="320"
                Background="#EE220000" 
                CornerRadius="10" 
                BorderBrush="#FF4444"
                BorderThickness="1"
                HorizontalAlignment="Center" 
                VerticalAlignment="Center"
                Visibility="Hidden"
                MouseLeftButtonDown="Panel_MouseLeftButtonDown">
            <Grid Margin="15">
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/> <!-- Header -->
                    <RowDefinition Height="Auto"/> <!-- Status -->
                    <RowDefinition Height="Auto"/> <!-- Stats -->
                    <RowDefinition Height="Auto"/> <!-- Buttons -->
                </Grid.RowDefinitions>

                <!-- Header -->
                <Grid Grid.Row="0" Margin="0,0,0,10">
                    <StackPanel Orientation="Horizontal" VerticalAlignment="Center">
                        <TextBlock Text="⏱ 실시간 트래커" Foreground="#FF4444" FontSize="16" FontWeight="Bold"/>
                        <TextBlock Text=" (LIVE)" Foreground="#FF0000" FontSize="12" VerticalAlignment="Bottom" Margin="5,0,0,2" FontWeight="Bold"/>
                    </StackPanel>
                    <StackPanel Orientation="Horizontal" HorizontalAlignment="Right">
                        <Button Content="─" Width="25" Height="25" Background="Transparent" Foreground="#AAAAAA" BorderThickness="0" FontWeight="Bold" Click="BtnMinimizeRealTime_Click" Cursor="Hand" Margin="0,0,5,0"/>
                        <Button Content="✕" Width="25" Height="25" Background="Transparent" Foreground="#AAAAAA" BorderThickness="0" FontWeight="Bold" Click="CloseRealTimeExpButton_Click" Cursor="Hand"/>
                    </StackPanel>
                </Grid>

                <!-- Status (OCR Debug) -->
                <StackPanel Grid.Row="1" Margin="0,0,0,10">
                    <TextBlock Text="[실시간 인식]" Foreground="#666666" FontSize="10"/>
                    <TextBlock x:Name="TxtRealTimeDebugOcr" Text="-" Foreground="#FF00FF" FontSize="11" Margin="0,0,0,10" TextWrapping="Wrap"/>
                </StackPanel>

                <!-- Stats -->
                <Border Grid.Row="2" Background="#33000000" CornerRadius="5" Padding="10" Margin="0,0,0,10">
                    <StackPanel>
                        <Grid Margin="0,0,0,5">
                            <TextBlock Text="시작 경험치" Foreground="#888888"/>
                            <TextBlock x:Name="TxtRealTimeStartExp" Text="-" Foreground="White" HorizontalAlignment="Right"/>
                        </Grid>
                        <Grid Margin="0,0,0,5">
                            <TextBlock Text="현재 경험치" Foreground="#888888"/>
                            <TextBlock x:Name="TxtRealTimeCurrentExp" Text="-" Foreground="White" HorizontalAlignment="Right"/>
                        </Grid>
                        <Separator Background="#444444" Margin="0,5"/>
                        <Grid Margin="0,0,0,5">
                            <TextBlock Text="획득 경험치" Foreground="#AAAAAA"/>
                            <TextBlock x:Name="TxtRealTimeGainedExp" Text="0" Foreground="#00FF00" HorizontalAlignment="Right" FontWeight="Bold"/>
                        </Grid>
                        <Grid Margin="0,0,0,5">
                            <TextBlock Text="경과 시간" Foreground="#AAAAAA"/>
                            <TextBlock x:Name="TxtRealTimeElapsedTime" Text="00:00:00" Foreground="#FFFF00" HorizontalAlignment="Right"/>
                        </Grid>
                        <Grid>
                            <TextBlock Text="시간당 획득" Foreground="#AAAAAA"/>
                            <TextBlock x:Name="TxtRealTimeExpPerHour" Text="0 / hr" Foreground="#00CCFF" HorizontalAlignment="Right" FontWeight="Bold"/>
                        </Grid>
                    </StackPanel>
                </Border>

                <!-- Buttons -->
                <Grid Grid.Row="3">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="10"/>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="10"/>
                        <ColumnDefinition Width="*"/>
                    </Grid.ColumnDefinitions>
                    
                    <Button x:Name="BtnPauseResumeRealTime" 
                            Grid.Column="0" 
                            Content="일시정지" 
                            Height="30" 
                            Background="#444444" 
                            Foreground="White" 
                            BorderThickness="0" 
                            Click="BtnPauseResumeRealTime_Click" 
                            Cursor="Hand" 
                            FontWeight="Bold"/>

                    <Button Grid.Column="2" 
                            Content="재시작" 
                            Height="30" 
                            Background="#006600" 
                            Foreground="White" 
                            BorderThickness="0" 
                            Click="BtnRestartRealTime_Click" 
                            Cursor="Hand" 
                            FontWeight="Bold"/>

                    <Button Grid.Column="4" 
                            Content="종료" 
                            Height="30" 
                            Background="#AA0000" 
                            Foreground="White" 
                            BorderThickness="0" 
                            Click="BtnStopRealTimeTracking_Click" 
                            Cursor="Hand" 
                            FontWeight="Bold"/>
                </Grid>
            </Grid>
        </Border>

        <!-- 4. 최소화 패널 (경험치 타이머용) -->
        <Border x:Name="MinimizedExpPanel" 
                Width="150" Height="40" 
                Background="#EE001100" 
                CornerRadius="20" 
                BorderBrush="#00FF00" 
                BorderThickness="1" 
                HorizontalAlignment="Center" 
                VerticalAlignment="Center" 
                Visibility="Hidden" 
                MouseLeftButtonDown="Panel_MouseLeftButtonDown">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>
                <TextBlock x:Name="TxtMinimizedExpStatus" Grid.Column="0" Text="타이머 대기" Foreground="White" VerticalAlignment="Center" HorizontalAlignment="Center" Margin="10,0,0,0" FontWeight="Bold"/>
                <Button Grid.Column="1" Content="☐" Width="30" Height="30" Margin="0,0,5,0" Background="Transparent" Foreground="#AAAAAA" BorderThickness="0" FontSize="16" Click="BtnRestoreExp_Click" Cursor="Hand" ToolTip="복원"/>
            </Grid>
        </Border>

        <!-- 5. 최소화 패널 (실시간 트래커용) -->
        <Border x:Name="MinimizedRealTimePanel" 
                Width="150" Height="40" 
                Background="#EE220000" 
                CornerRadius="20" 
                BorderBrush="#FF4444" 
                BorderThickness="1" 
                HorizontalAlignment="Center" 
                VerticalAlignment="Center" 
                Visibility="Hidden" 
                MouseLeftButtonDown="Panel_MouseLeftButtonDown">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>
                <TextBlock x:Name="TxtMinimizedRealTimeStatus" Grid.Column="0" Text="실시간 추적" Foreground="White" VerticalAlignment="Center" HorizontalAlignment="Center" Margin="10,0,0,0" FontWeight="Bold"/>
                <Button Grid.Column="1" Content="☐" Width="30" Height="30" Margin="0,0,5,0" Background="Transparent" Foreground="#AAAAAA" BorderThickness="0" FontSize="16" Click="BtnRestoreRealTime_Click" Cursor="Hand" ToolTip="복원"/>
            </Grid>
        </Border>

        <!-- 6. 모드 선택 메뉴 -->
        <Border x:Name="ModeSelectionPanel" Width="220" Background="#EE111111" CornerRadius="10" BorderBrush="#555555" BorderThickness="1" HorizontalAlignment="Center" VerticalAlignment="Center" Visibility="Collapsed">
            <StackPanel Margin="15">
                <TextBlock Text="기능 선택" Foreground="#DDDDDD" HorizontalAlignment="Center" Margin="0,0,0,15" FontSize="16" FontWeight="Bold"/>
                
                <Button Content="📷 경험치 UI 캡처" 
                        Height="40" 
                        Margin="0,0,0,10" 
                        Click="ModeCaptureExpUI_Click" 
                        Background="#004488" 
                        Foreground="White" 
                        FontSize="14"
                        BorderThickness="0"
                        Cursor="Hand"
                        Visibility="Collapsed"/>
                
                <Button Content="⏱ 실시간 경험치" Height="40" Margin="0,0,0,10" Click="ModeRealTimeExp_Click" Background="#333333" Foreground="White" FontSize="14" BorderThickness="0" Cursor="Hand" Visibility="Collapsed"/>
                <Button Content="⏱ 경험치 타이머" Height="40" Margin="0,0,0,10" Click="ModeExp_Click" Background="#333333" Foreground="White" FontSize="14" BorderThickness="0" Cursor="Hand" Visibility="Collapsed"/>
                <Button Content="⌨ 수동 검색" Height="40" Margin="0,0,0,10" Click="ModeManual_Click" Background="#333333" Foreground="White" FontSize="14" BorderThickness="0" Cursor="Hand"/>
                
                <Button Content="⚙ 설정" Height="40" Margin="0,0,0,10" Click="BtnSettings_Click" Background="#333333" Foreground="White" FontSize="14" BorderThickness="0" Cursor="Hand"/>
                <Button Content="✕ 닫기" Height="40" Margin="0,0,0,10" Click="BtnCloseMenu_Click" Background="#444444" Foreground="White" FontSize="14" BorderThickness="0" Cursor="Hand"/>
                <Button Content="❌ 종료" Height="40" Click="BtnExitApp_Click" Background="#AA0000" Foreground="White" FontSize="14" BorderThickness="0" Cursor="Hand"/>
                
                <TextBlock x:Name="MenuKeyGuideText" Text="(단축키: F12)" Foreground="#666666" HorizontalAlignment="Center" Margin="0,15,0,0" FontSize="11"/>
            </StackPanel>
        </Border>

        <!-- 7. 설정 패널 -->
        <Border x:Name="SettingsPanel" Width="250" Background="#EE111111" CornerRadius="10" BorderBrush="#555555" BorderThickness="1" HorizontalAlignment="Center" VerticalAlignment="Center" Visibility="Collapsed">
            <StackPanel Margin="15">
                <TextBlock Text="단축키 설정" Foreground="#DDDDDD" HorizontalAlignment="Center" Margin="0,0,0,15" FontSize="16" FontWeight="Bold"/>
                
                <Grid Margin="0,0,0,10">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="80"/>
                    </Grid.ColumnDefinitions>
                    <TextBlock Text="메뉴 열기" Foreground="White" VerticalAlignment="Center"/>
                    <TextBox x:Name="InputKeyMenu" Grid.Column="1" Height="25" Text="F12" HorizontalContentAlignment="Center" VerticalContentAlignment="Center" Background="#333333" Foreground="White" BorderThickness="0" IsReadOnly="True" PreviewKeyDown="InputKey_PreviewKeyDown" Tag="Menu"/>
                </Grid>

                <Grid Margin="0,0,0,10">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="80"/>
                    </Grid.ColumnDefinitions>
                    <TextBlock Text="아이템 캡처" Foreground="White" VerticalAlignment="Center"/>
                    <TextBox x:Name="InputKeyCapture" Grid.Column="1" Height="25" Text="`" HorizontalContentAlignment="Center" VerticalContentAlignment="Center" Background="#333333" Foreground="White" BorderThickness="0" IsReadOnly="True" PreviewKeyDown="InputKey_PreviewKeyDown" Tag="Capture"/>
                </Grid>

                <Grid Margin="0,0,0,10">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="80"/>
                    </Grid.ColumnDefinitions>
                    <TextBlock Text="수동 검색" Foreground="White" VerticalAlignment="Center"/>
                    <TextBox x:Name="InputKeyManualSearch" Grid.Column="1" Height="25" Text="\" HorizontalContentAlignment="Center" VerticalContentAlignment="Center" Background="#333333" Foreground="White" BorderThickness="0" IsReadOnly="True" PreviewKeyDown="InputKey_PreviewKeyDown" Tag="ManualSearch"/>
                </Grid>

                <Grid Margin="0,0,0,15">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="80"/>
                    </Grid.ColumnDefinitions>
                    <TextBlock Text="패널 닫기" Foreground="White" VerticalAlignment="Center"/>
                    <TextBox x:Name="InputKeyClose" Grid.Column="1" Height="25" Text="ESC" HorizontalContentAlignment="Center" VerticalContentAlignment="Center" Background="#333333" Foreground="White" BorderThickness="0" IsReadOnly="True" PreviewKeyDown="InputKey_PreviewKeyDown" Tag="Close"/>
                </Grid>

                <StackPanel Orientation="Horizontal" HorizontalAlignment="Center">
                    <Button Content="저장" Width="80" Height="30" Margin="0,0,10,0" Click="BtnSaveSettings_Click" Background="#006600" Foreground="White" BorderThickness="0" Cursor="Hand"/>
                    <Button Content="취소" Width="80" Height="30" Click="BtnCancelSettings_Click" Background="#444444" Foreground="White" BorderThickness="0" Cursor="Hand"/>
                </StackPanel>
            </StackPanel>
        </Border>

        <!-- 8. 캡처 모드용 오버레이 -->
        <Canvas x:Name="CaptureCanvas" Background="#01000000" Visibility="Collapsed" MouseDown="CaptureCanvas_MouseDown" MouseMove="CaptureCanvas_MouseMove" MouseUp="CaptureCanvas_MouseUp">
            <Border Background="#88000000" CornerRadius="5" Canvas.Left="10" Canvas.Top="10" Padding="10">
                <StackPanel>
                    <TextBlock Text="캡처 모드 (ESC: 취소)" Foreground="White" FontSize="16" FontWeight="Bold"/>
                    <TextBlock x:Name="CaptureModeText" Text="모드: -" Foreground="#00FF00" FontSize="14" Margin="0,5,0,0"/>
                </StackPanel>
            </Border>
            <Rectangle x:Name="SelectionRect" Stroke="#00FF00" StrokeThickness="2" Fill="#3300FF00" Visibility="Collapsed"/>
        </Canvas>

        <!-- 9. 플로팅 컨트롤 패널 -->
        <Border x:Name="FloatingControlPanel"
                HorizontalAlignment="Right"
                VerticalAlignment="Top"
                Margin="0,10,10,0"
                Background="#99000000"
                CornerRadius="5"
                Padding="0"
                MouseLeftButtonDown="Panel_MouseLeftButtonDown"
                Panel.ZIndex="999">
            <StackPanel>
                <!-- 드래그 핸들 영역 -->
                <Border Background="Transparent" Height="12" Cursor="SizeAll" ToolTip="드래그하여 이동">
                    <TextBlock Text="::::" Foreground="#888888" HorizontalAlignment="Center" VerticalAlignment="Center" FontSize="8" FontWeight="Bold"/>
                </Border>
                
                <!-- 버튼 영역 -->
                <StackPanel Orientation="Horizontal" Margin="5,0,5,5">
                    <Button x:Name="BtnOpenMenu" 
                            Content="☰" 
                            Width="20" Height="20" 
                            Background="Transparent" 
                            Foreground="White" 
                            BorderThickness="0" 
                            FontWeight="Bold" 
                            FontSize="12"
                            Click="BtnOpenMenu_Click"
                            Cursor="Hand"
                            ToolTip="메뉴 열기"/>
                    
                    <Button x:Name="BtnMinimizeControl" 
                            Content="─" 
                            Width="15" Height="20" 
                            Margin="5,0,0,0"
                            Background="Transparent" 
                            Foreground="#AAAAAA" 
                            BorderThickness="0" 
                            FontWeight="Bold" 
                            FontSize="10"
                            Click="BtnMinimizeControl_Click"
                            Cursor="Hand"
                            ToolTip="최소화"/>
                </StackPanel>
            </StackPanel>
        </Border>

        <!-- 10. 최소화된 컨트롤 패널 -->
        <Border x:Name="MinimizedControlPanel"
                HorizontalAlignment="Right"
                VerticalAlignment="Top"
                Margin="0,10,10,0"
                Width="25" Height="25"
                Background="#55000000"
                CornerRadius="12.5"
                Visibility="Hidden"
                MouseLeftButtonDown="Panel_MouseLeftButtonDown"
                Panel.ZIndex="999">
            <Button Content="+" 
                    Width="25" Height="25" 
                    Background="Transparent" 
                    Foreground="White" 
                    BorderThickness="0" 
                    FontWeight="Bold" 
                    FontSize="14"
                    Click="BtnRestoreControl_Click"
                    Cursor="Hand"
                    ToolTip="복원"/>
        </Border>
    </Grid>
</Window>